# 项目架构说明文档

## 一、系统架构图

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                              用户访问层                                      │
│                         http://192.168.58.129                               │
└─────────────────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                           Nginx 前端服务 (:80)                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐        │
│  │ index.html  │  │ admin.html  │  │  cart.html  │  │ orders.html │        │
│  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘        │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐                         │
│  │   api.js    │  │   app.js    │  │  style.css  │                         │
│  └─────────────┘  └─────────────┘  └─────────────┘                         │
└─────────────────────────────────────────────────────────────────────────────┘
                                    │
                                    │ /api/* 反向代理
                                    ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                      Spring Boot 后端服务 (:8080)                           │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │                         Controller 层                                │   │
│  │  ProductController  UserController  CartController  OrderController │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                    │                                        │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │                          Service 层                                  │   │
│  │  ProductService     UserService     CartService     OrderService    │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                    │                                        │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │                        Repository 层 (JPA)                           │   │
│  │  ProductRepository  UserRepository  CartRepository  OrderRepository │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────────────────┘
                                    │
                                    │ JDBC
                                    ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                         MySQL 数据库 (:3306)                                │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐    │
│  │   products   │  │    users     │  │  cart_items  │  │    orders    │    │
│  └──────────────┘  └──────────────┘  └──────────────┘  └──────────────┘    │
│  ┌──────────────┐                                                           │
│  │ order_items  │                                                           │
│  └──────────────┘                                                           │
└─────────────────────────────────────────────────────────────────────────────┘
```

## 二、容器架构图

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                          Docker Host (虚拟机)                               │
│                                                                             │
│  ┌─────────────────────── ecommerce-network ───────────────────────────┐   │
│  │                                                                      │   │
│  │  ┌──────────────┐    ┌──────────────┐    ┌──────────────┐          │   │
│  │  │  frontend    │    │   backend    │    │    mysql     │          │   │
│  │  │  (Nginx)     │───▶│ (Spring Boot)│───▶│   (MySQL)    │          │   │
│  │  │  :80         │    │  :8080       │    │  :3306       │          │   │
│  │  └──────────────┘    └──────────────┘    └──────────────┘          │   │
│  │                                                │                     │   │
│  │  ┌──────────────┐                              │                     │   │
│  │  │  phpmyadmin  │──────────────────────────────┘                     │   │
│  │  │  :8081       │                                                    │   │
│  │  └──────────────┘                                                    │   │
│  │                                                                      │   │
│  └──────────────────────────────────────────────────────────────────────┘   │
│                                                                             │
│  ┌─────────────────────── jenkins-network ─────────────────────────────┐   │
│  │                                                                      │   │
│  │  ┌──────────────┐    ┌──────────────┐                               │   │
│  │  │   jenkins    │    │   registry   │                               │   │
│  │  │  :8082       │    │  :5000       │                               │   │
│  │  └──────────────┘    └──────────────┘                               │   │
│  │                                                                      │   │
│  └──────────────────────────────────────────────────────────────────────┘   │
│                                                                             │
│  ┌─────────────────────── 数据卷 ──────────────────────────────────────┐   │
│  │  mysql_data    jenkins_home    registry_data                        │   │
│  └──────────────────────────────────────────────────────────────────────┘   │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

## 三、CI/CD 流程图

```
┌──────────┐    ┌──────────┐    ┌──────────┐    ┌──────────┐    ┌──────────┐
│  开发者   │───▶│  GitHub  │───▶│ Jenkins  │───▶│ Registry │───▶│  生产环境 │
│ 提交代码  │    │   仓库   │    │  构建    │    │ 镜像仓库  │    │   部署   │
└──────────┘    └──────────┘    └──────────┘    └──────────┘    └──────────┘
                                     │
                    ┌────────────────┼────────────────┐
                    ▼                ▼                ▼
              ┌──────────┐    ┌──────────┐    ┌──────────┐
              │ 代码检出  │    │ 单元测试  │    │ 镜像构建  │
              └──────────┘    └──────────┘    └──────────┘
```

## 四、技术栈

### 4.1 前端技术
| 技术 | 版本 | 说明 |
|------|------|------|
| Nginx | alpine | 静态资源服务器 |
| HTML5 | - | 页面结构 |
| CSS3 | - | 样式设计 |
| JavaScript | ES5 | 交互逻辑 |
| Fetch API | - | HTTP请求 |

### 4.2 后端技术
| 技术 | 版本 | 说明 |
|------|------|------|
| Java | 21 | 编程语言 |
| Spring Boot | 3.2.0 | 应用框架 |
| Spring Data JPA | - | 数据访问 |
| Maven | 3.9 | 构建工具 |
| JUnit 5 | - | 单元测试 |

### 4.3 数据库
| 技术 | 版本 | 说明 |
|------|------|------|
| MySQL | 8.0 | 关系型数据库 |
| phpMyAdmin | latest | 数据库管理 |

### 4.4 容器化
| 技术 | 版本 | 说明 |
|------|------|------|
| Docker | 26.1.4 | 容器运行时 |
| Docker Compose | 2.27.1 | 容器编排 |
| Registry | 2 | 私有镜像仓库 |

### 4.5 CI/CD
| 技术 | 版本 | 说明 |
|------|------|------|
| Jenkins | lts-jdk21 | 持续集成 |
| GitHub Actions | - | 云端CI/CD |

## 五、目录结构

```
ecommerce-system/
├── .github/
│   └── workflows/
│       └── ci-cd.yml           # GitHub Actions工作流
├── backend/                     # 后端服务
│   ├── src/
│   │   ├── main/
│   │   │   ├── java/com/ecommerce/
│   │   │   │   ├── controller/  # 控制器层
│   │   │   │   ├── service/     # 服务层
│   │   │   │   ├── repository/  # 数据访问层
│   │   │   │   ├── entity/      # 实体类
│   │   │   │   └── config/      # 配置类
│   │   │   └── resources/
│   │   │       ├── application.yml      # 主配置
│   │   │       └── application-prod.yml # 生产配置
│   │   └── test/                # 测试代码
│   ├── Dockerfile               # 后端镜像构建
│   └── pom.xml                  # Maven配置
├── frontend/                    # 前端服务
│   ├── html/
│   │   ├── css/                 # 样式文件
│   │   ├── js/                  # JavaScript文件
│   │   ├── images/              # 图片资源
│   │   └── *.html               # HTML页面
│   ├── nginx.conf               # Nginx配置
│   └── Dockerfile               # 前端镜像构建
├── database/                    # 数据库
│   ├── init.sql                 # 初始化脚本
│   ├── my.cnf                   # MySQL配置
│   └── Dockerfile               # 数据库镜像
├── jenkins/                     # Jenkins配置
│   ├── docker-compose.jenkins.yml
│   └── Jenkinsfile
├── k8s/                         # Kubernetes配置
│   ├── namespace.yaml
│   ├── configmap.yaml
│   ├── secret.yaml
│   ├── mysql-deployment.yaml
│   ├── backend-deployment.yaml
│   ├── frontend-deployment.yaml
│   ├── ingress.yaml
│   └── blue-green/              # 蓝绿部署
├── monitoring/                  # 监控配置
│   ├── docker-compose.monitoring.yml
│   ├── prometheus/
│   └── grafana/
├── docs/                        # 文档
│   ├── architecture.md          # 架构说明
│   ├── dockerfile-guide.md      # Dockerfile说明
│   ├── deployment-guide.md      # 部署指南
│   ├── troubleshooting.md       # 故障排查
│   └── cicd-guide.md            # CI/CD指南
├── scripts/                     # 脚本
│   ├── build.sh
│   ├── start.sh
│   ├── stop.sh
│   └── test.sh
├── docker-compose.yml           # 主编排文件
├── .env                         # 环境变量
├── .gitignore
└── README.md
```

## 六、数据库设计

### 6.1 ER图

```
┌─────────────────┐       ┌─────────────────┐
│     users       │       │    products     │
├─────────────────┤       ├─────────────────┤
│ id (PK)         │       │ id (PK)         │
│ username        │       │ name            │
│ password        │       │ description     │
│ role            │       │ price           │
│ created_at      │       │ stock           │
└────────┬────────┘       │ image_url       │
         │                │ category        │
         │                │ status          │
         │                │ created_at      │
         │                └────────┬────────┘
         │                         │
         ▼                         ▼
┌─────────────────┐       ┌─────────────────┐
│   cart_items    │       │  order_items    │
├─────────────────┤       ├─────────────────┤
│ id (PK)         │       │ id (PK)         │
│ user_id (FK)    │       │ order_id (FK)   │
│ product_id (FK) │       │ product_id (FK) │
│ quantity        │       │ quantity        │
│ created_at      │       │ price           │
└─────────────────┘       └────────┬────────┘
                                   │
                                   ▼
                          ┌─────────────────┐
                          │     orders      │
                          ├─────────────────┤
                          │ id (PK)         │
                          │ user_id (FK)    │
                          │ total_amount    │
                          │ status          │
                          │ created_at      │
                          │ updated_at      │
                          └─────────────────┘
```

### 6.2 表结构说明

| 表名 | 说明 | 主要字段 |
|------|------|----------|
| users | 用户表 | id, username, password, role |
| products | 商品表 | id, name, price, stock, status |
| cart_items | 购物车表 | id, user_id, product_id, quantity |
| orders | 订单表 | id, user_id, total_amount, status |
| order_items | 订单明细表 | id, order_id, product_id, quantity, price |

## 七、API接口设计

### 7.1 商品接口
| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /api/products | 获取商品列表 |
| GET | /api/products/{id} | 获取商品详情 |
| POST | /api/products | 创建商品 |
| PUT | /api/products/{id} | 更新商品 |
| DELETE | /api/products/{id} | 删除商品 |

### 7.2 用户接口
| 方法 | 路径 | 说明 |
|------|------|------|
| POST | /api/users/login | 用户登录 |

### 7.3 购物车接口
| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /api/cart/{userId} | 获取购物车 |
| POST | /api/cart/{userId} | 添加商品 |
| PUT | /api/cart/{userId}/{productId} | 更新数量 |
| DELETE | /api/cart/{userId}/{productId} | 删除商品 |

### 7.4 订单接口
| 方法 | 路径 | 说明 |
|------|------|------|
| POST | /api/orders | 创建订单 |
| GET | /api/orders/{id} | 获取订单详情 |
| GET | /api/orders/user/{userId} | 获取用户订单 |
| POST | /api/orders/{id}/pay | 支付订单 |
| POST | /api/orders/{id}/ship | 发货 |
| POST | /api/orders/{id}/cancel | 取消订单 |

## 八、安全设计

### 8.1 网络安全
- 使用Docker自定义网络隔离服务
- 数据库仅在内部网络暴露
- 前端通过Nginx反向代理访问后端

### 8.2 数据安全
- 数据库密码通过环境变量配置
- 敏感配置使用.env文件管理
- 生产环境使用Kubernetes Secret

### 8.3 应用安全
- 用户密码加密存储
- API接口参数校验
- 异常统一处理
